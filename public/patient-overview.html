<!DOCTYPE html>
<!--  This site was created in Webflow. http://www.webflow.com  -->
<!--  Last Published: Sat Apr 11 2020 10:40:25 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="5e913ac34660cb81d7d7ddc2" data-wf-site="5e89e56bbebe7d2e8604de36">

<head>
    <meta charset="utf-8">
    <title>Patient Overview</title>
    <meta content="Patient Overview" property="og:title">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="Webflow" name="generator">
    <link href="css/normalize.css" rel="stylesheet" type="text/css">
    <link href="css/webflow.css" rel="stylesheet" type="text/css">
    <link href="css/safeco.webflow.css" rel="stylesheet" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
    <script type="text/javascript">
        WebFont.load({
            google: {
                families: ["Inter:100,200,300,regular,500,600,700,800,900", "Roboto:100,100italic,300,300italic,regular,italic,500,500italic,700,700italic,900,900italic", "Muli:200,300,regular,500,600,700,800,900,200italic,300italic,italic,500italic,600italic,700italic,800italic,900italic"]
            }
        });
    </script>
    <!-- [if lt IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" type="text/javascript"></script><![endif] -->
    <script type="text/javascript">
        ! function(o, c) {
            var n = c.documentElement,
                t = " w-mod-";
            n.className += t + "js", ("ontouchstart" in o || o.DocumentTouch && c instanceof DocumentTouch) && (n.className += t + "touch")
        }(window, document);
    </script>
    <link href="images/cov2_favicon.png" rel="shortcut icon" type="image/x-icon">
    <link href="images/webclip.png" rel="apple-touch-icon">
    <style>
         ::-webkit-scrollbar {
            width: 12px;
            /* Controls the overall width of the scrollbar */
            padding: 2.5px;
            /* Controls the padding of the Scrollbar */
        }
        /* Track - This is the part that contains the bit you click and drag */
        
         ::-webkit-scrollbar-track {
            background: transparent;
            /* Sets the background to transparent, change to a Hex or RGB value if you would like */
        }
        /* Handle - This is the bit you actually click and drag */
        
         ::-webkit-scrollbar-thumb {
            background: #828592;
            /* Change the Hex value to change the scroll handle */
            border-radius: 6px;
            /* Change the "px" to adjust the scroll handle's border radius*/
            border: white 1px solid/* This controls whether the scroll handle has a border, right now it's set to a White, 1px Solid border, you can change these settings or remove this line altogether if you don't want a border */
        }
        
        .SCROLLABLE-Section-4 {
            overflow-x: hidden;
        }
    </style>
</head>

<body class="body">
    <div class="div-block-69" id="discharge_popup" style="display:none;">
        <div class="form-block-5 w-form">
            <form id="discharge_form">
                <div class="patient-db-form status">
                    <div class="text-block-13">Remove Patient from Facility</div>
                    <!-- <div class="div-block-70"><label for="name" class="field-label patient white">Reason:</label>
                        <input type="text" class="patient-db-text-field w-input" maxlength="256" name="field-5" data-name="Field 5" placeholder="Example Text" id="field-5" required="">
                    </div> -->
                    <div class="div-block-70"><label for="name" class="field-label patient white">Reason:</label>
                        <select id="discharge_reason" name="discharge-reason" required data-name="Field 4" class="patient-db-text-field w-select">.val();
                            <option value="">Select one...</option> 
                            <option value="DISCHARGED">Discharged</option>
                            <option value="DECEASED">Deceased </option>
                        </select>
                    </div>
                    <div class="div-block-70" id="discharge_quarantine_type_block" style="display:none">
                        <label for="name" class="field-label patient white">Quarantine Type:</label>
                        <select id="discharge_quarantine_type" name="discharge_quarantine_type" data-name="Field 4" class="patient-db-text-field w-select" required>
                            <option value="">Select one...</option>
                            <option value="HOME_QUARANTINE">Home Quarantine</option>
                            <option value="INSTITUTIONAL_QUARANTINE">Institutional Quarantine</option>
                        </select>
                    </div>
                    <div class="div-block-71"><input type="reset" id="discharge_form_cancel" class="signup-button status-form _2 cancel w-button" value="CANCEL"><input type="submit" href="#" class="button-5 w-button" value="Remove Patient"></div>
                </div>
            </form>
        </div>
    </div>
    <div class="div-block-4 status-form" id="patient_form">
        <div class="div-block status-form">
            <div class="columns-4 w-row">
                <div class="w-col w-col-2">
                    <div class="div-block-2 status-form">
                        <div class="section">
                            <div class="div-block-26">
                                <div class="logo-div w-inline-block"></div>
                            </div>
                        </div>
                    </div>
                    <div class="section">
                        <a href="status-form.html" class="logout-button  w-inline-block">
                            <div class="">Home</div>
                            </>
                            <a href="patient-overview.html" class="logout-button  w-inline-block">
                                <div class="">Add New Patient +</div>
                            </a>
                            <a href="list-of-referred-patients.html" class="logout-button  w-inline-block">
                                <div class="">referred patients</div>
                            </a>
                            <a href="list-of-patients.html" class="logout-button  w-inline-block">
                                <div class="">Patients LIST</div>
                            </a>
                            <a href="profile-form.html" class="logout-button  w-inline-block">
                                <div class="">Edit Profile</div>
                            </a>
                            <a href="#" id="logout" class="logout-button w-inline-block">
                                <div>Logout</div>
                            </a>
                    </div>
                </div>
                <div class="column w-col w-col-10">
                    <div class="div-block-44">
                        <div class="hospital-profile-header-div _1">
                            <h1 class="heading-2 _1">Patient Details</h1><a href="#" id="remove_patient" class="button-3 ward remove w-button" style="display:none">- Remove Patient</a>
                        </div>
                        <form id="patient_form" name="patient_form" data-name="Patient Form">
                            <div class="div-block-36 _1">
                                <div class="section-7">
                                    <div class="w-row">
                                        <div class="w-col w-col-6">
                                            <div class="form-block-3 w-form">
                                                <div class="form-section-div _23">
                                                    <div class="div-block-8-copy">
                                                        <div class="patient-db-form">
                                                            <label for="patient_hospital_id" class="field-label patient">Patient ID:</label>
                                                            <input type="text" class="patient-db-text-field w-input" name="patient_hospital_id" data-name="Patient hospital Id" placeholder="Patient ID" id="patient_hospital_id">
                                                        </div>
                                                        <div class="patient-db-form">
                                                            <label for="name" class="field-label patient">Name:</label>
                                                            <input type="text" class="patient-db-text-field w-input" maxlength="256" name="name" data-name="Name" placeholder="Name" id="name" required>
                                                        </div>
                                                        <!-- <div class="patient-db-form">
                                                            <label for="last_name" class="field-label patient">Last Name:</label>
                                                            <input type="text" class="patient-db-text-field w-input" maxlength="256" name="last_name" data-name="Last Name" placeholder="Last Name" id="last_name" required>
                                                        </div> -->
                                                        <div class="patient-db-form">
                                                            <label for="age" class="field-label patient">Age:</label>
                                                            <input type="number" min=1 class="patient-db-text-field _1 w-input" maxlength="256" name="age" data-name="age" placeholder="age" id="age" required>
                                                            <div class="patient-db-form">
                                                                <label for="gender" class="field-label patient">Gender:</label>
                                                                <select id="gender" name="gender" data-name="gender" class="patient-db-text-field w-select" required>
                                                                    <option value="">Select one...</option>
                                                                    <option value="Male">Male</option>
                                                                    <option value="Female">Female</option>
                                                                    <option value="Other">Other</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="w-form-done">
                                                    <div>Thank you! Your submission has been received!</div>
                                                </div>
                                                <div class="w-form-fail">
                                                    <div>Oops! Something went wrong while submitting the form.</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="w-col w-col-6">
                                            <div class="form-block-3 w-form">
                                                <div class="form-section-div _2">
                                                    <div class="div-block-8-copy">
                                                        <div class="patient-db-form">
                                                            <label for="mobile_number" class="field-label patient">Mobile:</label>
                                                            <input type="number" pattern="\d{3}[\-]\d{3}[\-]\d{4}" maxlength=10 minlength=10 class="patient-db-text-field w-input" name="mobile_number" data-name="Mobile No" placeholder="+91" id="mobile_number" required>
                                                        </div>
                                                        <div class="patient-db-form">
                                                            <label for="address" class="field-label patient">Address:</label>
                                                            <input type="text" class="patient-db-text-field w-input" maxlength="256" name="address" data-name="address" placeholder="address" id="address">
                                                        </div>
                                                        <div class="patient-db-form">
                                                            <label for="emergency_contact" class="field-label patient">Emergency:</label>
                                                            <input type="number" pattern="\d{3}[\-]\d{3}[\-]\d{4}" maxlength=10 minlength=10 class="patient-db-text-field w-input" name="emergency_contact" data-name="Emergency COntact" placeholder="+91 " id="emergency_contact">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="w-form-done">
                                                    <div>Thank you! Your submission has been received!</div>
                                                </div>
                                                <div class="w-form-fail">
                                                    <div>Oops! Something went wrong while submitting the form.</div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- <div class="w-col w-col-6">
                                            <div class="form-block-3 w-form">
                                                <div class="form-section-div _2">
                                                    <div class="div-block-8-copy">
                                                        <div class="patient-db-form">
                                                            <input type="submit" class="signup-button status-form _2 _1 w-button" value="Save" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div> -->
                                    </div>
                                </div>
                                <!-- </form>
                        <form id="patient_status_form" name="patient_status_form" data-name="Patient Status Form"> -->
                                <div class="section-9">
                                    <div class="w-row">
                                        <div class="w-col w-col-6">
                                            <div class="form-block-3 w-form">
                                                <div class="form-section-div _23">
                                                    <div class="div-block-8-copy _1">
                                                        <div class="patient-db-form">
                                                            <label for="severity" class="field-label patient white">Severity:</label>
                                                            <select id="severity" name="severity" data-name="Field 4" class="patient-db-text-field w-select">
                                                                <option value="MILD">Mild or Very Mild</option>
                                                                <option value="MODERATE">Moderate</option>
                                                                <option value="SEVERE">Severe</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="w-form-done">
                                                    <div>Thank you! Your submission has been received!</div>
                                                </div>
                                                <div class="w-form-fail">
                                                    <div>Oops! Something went wrong while submitting the form.</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="w-col w-col-6">
                                            <div class="form-block-3 w-form">
                                                <div class="form-section-div _23 _1">
                                                    <div class="div-block-8-copy _1">
                                                        <div class="patient-db-form">
                                                            <label for="test_status" class="field-label patient white">COVID-19 Test:</label>
                                                            <select id="test_status" name="test_status" data-name="Field 4" class="patient-db-text-field w-select">
                                                                <option value="PENDING_TEST">Test Pending</option>
                                                                <option value="PENDING_RESULT">Test Result Pending</option>
                                                                <option value="POSITIVE">Positive</option>
                                                                <option value="NEGATIVE">Negative</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="w-form-done">
                                                    <div>Thank you! Your submission has been received!</div>
                                                </div>
                                                <div class="w-form-fail">
                                                    <div>Oops! Something went wrong while submitting the form.</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div data-duration-in="500" data-duration-out="200" data-easing="ease-in" class="w-tabs">
                                        <div class="tabs-menu-4 w-tab-menu">
                                            <a id="allocate_your_facility" data-w-tab="Tab 1" class="allocate-tab-link w-inline-block w-tab-link w--current">
                                                <div>Allocate IN your Facility</div>
                                            </a>
                                            <a id="allocate_other_facility" data-w-tab="Tab 2" class="allocate-tab-link w-inline-block w-tab-link">
                                                <div>Allocate to other Facility</div>
                                            </a>
                                        </div>
                                        <div class="w-tab-content">
                                            <div data-w-tab="Tab 1" class="w-tab-pane w--tab-active">
                                                <div class="div-block-45">
                                                    <div class="text-block-7">Available Wards in your facility</div>
                                                    <div class="div-block-64">
                                                        <div class="columns-6 w-row">
                                                            <!-- <div class="w-col w-col-1">
                                                                <a href="#" class="link-block-3 _1 w-inline-block">
                                                                    <div class="legends">Sr No</div>
                                                                </a>
                                                            </div> -->
                                                            <div class="w-col w-col-3">
                                                                <a href="#" class="link-block-3 w-inline-block">
                                                                    <div class="legends">Ward</div>
                                                                </a>
                                                            </div>
                                                            <div class="w-col w-col-3">
                                                                <a href="#" class="link-block-3 w-inline-block">
                                                                    <div class="legends">Severity</div>
                                                                </a>
                                                            </div>
                                                            <div class="w-col w-col-3">
                                                                <a href="#" class="link-block-3 w-inline-block">
                                                                    <div class="legends">Covid Ward Type</div>
                                                                </a>
                                                            </div>
                                                            <div class="w-col w-col-2">
                                                                <a href="#" class="link-block-3 w-inline-block">
                                                                    <div class="legends">Available Beds</div>
                                                                </a>
                                                            </div>
                                                            <div class="w-col w-col-1">
                                                                <a href="#" class="link-block-3 _1 w-inline-block">
                                                                    <div class="legends">ACtion</div>
                                                                </a>
                                                            </div>
                                                        </div>
                                                        <div class="div-block-42 ward" id="ward_list">

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div data-w-tab="Tab 2" class="w-tab-pane">
                                                <div class="div-block-45 facilities">
                                                    <div class="text-block-7">Facilities with <span id="severity_1">Mild or Very Mild</span> wards</div>
                                                    <div class="div-block-64">
                                                        <div class="columns-6 w-row">
                                                            <div class="w-col w-col-3">
                                                                <a href="#" class="link-block-3 w-inline-block">
                                                                    <div class="legends">Facility Name</div>
                                                                </a>
                                                            </div>
                                                            <div class="w-col w-col-2">
                                                                <a href="#" class="link-block-3 w-inline-block">
                                                                    <div class="legends">Area</div>
                                                                </a>
                                                            </div>
                                                            <div class="w-col w-col-2">
                                                                <a href="#" class="link-block-3 w-inline-block">
                                                                    <div class="legends">Covid Facility Type</div>
                                                                </a>
                                                            </div>
                                                            <div class="w-col w-col-2">
                                                                <a href="#" class="link-block-3 w-inline-block">
                                                                    <div class="legends">Covid Status</div>
                                                                </a>
                                                            </div>
                                                            <div class="w-col w-col-2">
                                                                <a href="#" class="link-block-3 w-inline-block">
                                                                    <div class="legends">Availability</div>
                                                                </a>
                                                            </div>
                                                            <div class="w-col w-col-1">
                                                                <a href="#" class="link-block-3 _1 w-inline-block">
                                                                    <div class="legends">ACtion</div>
                                                                </a>
                                                            </div>
                                                        </div>
                                                        <div class="div-block-42" id="facility_list">

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="div-block-43"><input type='reset' id="cancel_button" class="signup-button status-form _2 cancel w-button" value="CANCEL" /><input type="submit" class="signup-button status-form _2 _1 w-button" value="Save" /></div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.4.1.min.220afd743d.js?site=5e89e56bbebe7d2e8604de36" type="text/javascript" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="js/globalconf.js" type="text/javascript"></script>
    <script src="js/config.js" type="text/javascript"></script>
    <script src="js/webflow.js" type="text/javascript"></script>
    <!-- [if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif] -->
    <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-firestore.js"></script>
    <script>
        // Your web app's Firebase configuration
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();
    </script>
    <script>
        $(document).ready(function() {
            currentUser = null;
            currentFacility = null;
            updatePatient = false;
            patientProfileData = null;
            patientStatusData = null;
            selectedFacilityId = 0;
            selectedWardId = 0;
            wardOrFacility = true;
            dataAuthToken = {
                "authToken": window.localStorage.getItem("authToken")
            };
            headers = {
                "Content-Type": "application/json"
            };
            if (window.localStorage.getItem("authToken") == null) {
                $("#logout").click(); //logout if authToken is not available
                return;
            }

            //first fetch current user and facility
            fetchUserAndFacility();

            // if (getUrlParam("patient_id") != null) {
            //     updatePatient = true;
            // }
            // if (updatePatient) {
            //refresh patient data and update the fields
            // fetchPatientData();

            //assume current facility is selected
            // fetchWards();

            //fetch wards on the basis of severity and testStatus
            //wards are not necessary

            // } else {
            //assume current facility is selected
            //fetch wards on the basis of severity and testStatus
            //wards are not necessary
            // }

            function fetchPatientData() { //exec_5
                if (getUrlParam("patient_id") != null) {
                    //get patient details
                    $("#remove_patient").show();
                    updatePatient = true;
                    patientId = getUrlParam("patient_id");
                    patientProfileURL = apiURL + "patients/" + patientId + "/profile/get";
                    $.ajax({
                        type: "POST",
                        url: patientProfileURL,
                        data: JSON.stringify(dataAuthToken),
                        headers: headers,
                        success: function(res) {
                            patientProfileData = res.data.profile;
                            log("Patient profile response", res)
                            refreshPatientProfile();
                        }, //success function ends
                        error: function(jqXHR, textStatus, error) {
                            alert("error: " + error);
                        },
                    }); //get patient profile
                    patientStatusURL = apiURL + "patients/" + patientId + "/status/get";
                    $.ajax({
                        type: "POST",
                        url: patientStatusURL,
                        data: JSON.stringify(dataAuthToken),
                        headers: headers,
                        success: function(res) {
                            patientStatusData = res.data.patientStatus;
                            log("Patient Status Data: ", patientStatusData);
                            log("User Facility: ", currentFacility);
                            if (patientStatusData.facilityId != currentFacility.facilityId) {
                                $("#logout").click();
                            }
                            log("patient status data: ", res);
                            refreshPatientStatus();
                            fetchWards();
                            fetchFacility();
                        }, //success function ends
                        error: function(jqXHR, textStatus, error) {
                            alert("error: " + error);
                        },
                    }); //get patient profile
                } else {
                    //no patient 
                    $("#remove_patient").hide();
                }
                selectedFacilityId = currentFacility.facilityId;
            }

            function fetchFacilityUsingId(facilityId) { // exec_2
                data = {
                    "authToken": window.localStorage.getItem("authToken"),
                    "severity": $("#severity").val(),
                    "testStatus": $("#test_status").val(),
                }
                fetchFacilityURL = apiURL + "facility/" + facilityId;
                $.ajax({
                    type: "POST",
                    url: fetchFacilityURL,
                    data: JSON.stringify(data),
                    headers: headers,
                    success: function(res) {
                        log("User Facility Response:", res);
                        currentFacility = res.data;
                        fetchPatientData();
                        // fetchFacility();
                        fetchWards();
                    }, //success function ends
                    error: function(jqXHR, textStatus, error) {
                        alert("error: " + error);
                    },
                }); //fetch Facility ajax
            } //fetchFacility

            function fetchUserAndFacility() { // exec_1
                var userProfileURL = apiURL + "hospital/user/profile";
                $.ajax({
                    type: "POST",
                    url: userProfileURL,
                    data: JSON.stringify(dataAuthToken),
                    headers: headers,
                    success: function(res) {
                        var userData = res.data;
                        var userProfile = userData.profile;
                        fetchFacilityUsingId(userProfile.facilityId);
                    }, //userProfile success function ends
                    error: function(jqXHR, textStatus, error) {
                        alert("user profile error: " + error);
                    },
                }); //ajax userProfile 

            }

            $("#logout").click(function() {
                firebase.auth().signOut().then(function() {
                    // Sign-out successful.
                    window.localStorage.removeItem("authToken");
                    window.location.href = "index.html";
                }).catch(function(error) {
                    alert("Error in Sign-out." + error);
                });
            });

            $("#cancel_button").click(function(e) {
                $.selectFacility(currentFacility.facilityId);
                if (updatePatient) {
                    try {
                        refreshPatientProfile();
                    } catch (e) {
                        log("refreshPatientProfile Error:", e);
                    }
                    try {
                        refreshPatientStatus();
                    } catch (e) {
                        log("refreshPatientStatus Error:", e);
                    }
                    e.preventDefault();
                }
            });
            $("#patient_form").submit(function(e) {
                log("ward and facility on submit: ", {
                    "ward": selectedWardId,
                    "facility": selectedFacilityId
                });
                if (selectedFacilityId == 0) {
                    alert("Please select a facility");
                    e.preventDefault();
                    return;
                }
                if (!updatePatient) {
                    data = {
                        "authToken": window.localStorage.getItem("authToken"),
                        "address": $("#address").val(),
                        "age": $("#age").val(),
                        "contactNumber": $("#mobile_number").val(),
                        "gender": $("#gender").val(),
                        "name": $("#name").val(),
                        "patientHospitalId": $("#patient_hospital_id").val(),
                        "emergencyContact": $("#emergency_contact").val(),
                        "facilityId": selectedFacilityId,
                        "severity": $("#severity").val(),
                        "testStatus": $("#test_status").val(),
                        "wardId": selectedWardId,
                    };
                    newPatientURL = apiURL + "patients/new";
                    $.ajax({
                        type: "POST",
                        url: newPatientURL,
                        data: JSON.stringify(data),
                        headers: headers,
                        success: function(res) {
                            if (res.data.success) {
                                alert("Patient Added");
                                window.location.href = "list-of-patients.html";
                            } else {
                                alert("Error in adding patient:" + res.error)
                            }
                        }, //success function ends
                        error: function(jqXHR, textStatus, error) {
                            alert("error: " + error);
                        },
                    }); //register new patient 
                } else {
                    updatePatientProfile();
                    updatePatientStatus();
                }
                e.preventDefault();

            }); // patient form submit


            function refreshPatientStatus() {
                $("#severity").val(patientStatusData.severity);
                $("#test_status").val(patientStatusData.testStatus);
                $.selectWard(patientStatusData.wardId);
            }

            function refreshPatientProfile() {
                $("#patient_hospital_id").val(patientProfileData.patientHospitalId);
                $("#name").val(patientProfileData.name);
                $("#mobile_number").val(patientProfileData.contactNumber);
                $("#emergency_contact").val(patientProfileData.emergencyContact);
                $("#gender").val(patientProfileData.gender);
                $("#age").val(patientProfileData.age);
                $("#address").val(patientProfileData.address);
            }

            function updatePatientProfile() {
                data = {
                    "authToken": window.localStorage.getItem("authToken"),
                    "address": $("#address").val(),
                    "age": $("#age").val(),
                    "contactNumber": $("#mobile_number").val(),
                    "emergencyContact": $("#emergency_contact").val(),
                    "gender": $("#gender").val(),
                    "name": $("#name").val(),
                    "patientHospitalId": $("#patient_hospital_id").val(),
                };
                updatePatientProfileURL = apiURL + "patients/" + getUrlParam("patient_id") + "/profile/post";
                $.ajax({
                    type: "POST",
                    url: updatePatientProfileURL,
                    data: JSON.stringify(data),
                    headers: headers,
                    success: function(res) {
                        log("Update Patient Profile Response", res);
                        if (res.error == null)
                            alert("Profile updated");
                        else
                            alert("Profile update error:" + res.error);
                    }, //success function ends
                    error: function(jqXHR, textStatus, error) {
                        alert("Profile update request error: " + error);
                    },
                });
            }

            function updatePatientStatus() {
                data = {
                    "authToken": window.localStorage.getItem("authToken"),
                    "facilityId": selectedFacilityId,
                    "severity": $("#severity").val(),
                    "testStatus": $("#test_status").val(),
                    "wardId": selectedWardId,
                    // "patientId": getUrlParam("patient_id"),
                };
                updatePatientStatusURL = apiURL + "patients/" + getUrlParam("patient_id") + "/status/post";
                // updatePatientStatusURL = apiURL + "patient/status/update";
                $.ajax({
                    type: "POST",
                    url: updatePatientStatusURL,
                    data: JSON.stringify(data),
                    headers: headers,
                    success: function(res) {
                        log("Update Patient Status Response", res);
                        if (res.data.success)
                            alert("Status updated");
                        else
                            alert("Status update error:" + res.error);
                    }, //success function ends
                    error: function(jqXHR, textStatus, error) {
                        alert("Status update request error: " + error);
                    },
                });
            } //updatePatientStatus

            function fetchFacility() {
                data = {
                    "authToken": window.localStorage.getItem("authToken"),
                    "severity": $("#severity").val(),
                    "testStatus": $("#test_status").val(),
                    // "facilityId": currentFacility.facilityId,
                }
                log("fetching facility data:", data);
                fetchFacilityURL = apiURL + "facilities/" + currentFacility.facilityId;
                $.ajax({
                    type: "POST",
                    url: fetchFacilityURL,
                    data: JSON.stringify(data),
                    headers: headers,
                    success: function(res) {
                        // if (updatePatient)
                        //     selectedFacilityId = currentFacility.facilityId;
                        showFacility(res.data.list);
                    }, //success function ends
                    error: function(jqXHR, textStatus, error) {
                        alert("error: " + error);
                    },
                }); //fetch Facility ajax
            } //fetchFacility

            $.selectFacility = function(facilityId) {
                $("#facility_" + selectedFacilityId).html("Select");
                $("#facility_" + selectedFacilityId).css("background-color", "#4c72bf");
                $("#facility_" + facilityId).html("Selected");
                $("#facility_" + facilityId).css("background-color", "green");
                selectedFacilityId = facilityId;
                // $.selectWard(0);
                selectedWardId = 0;
                // fetchWards();
                log("selecting facility: ", {
                    "facility": selectedFacilityId,
                    "ward": selectedWardId,
                });
            }

            function showFacility(facilities) {
                log("Facilities to show: ", facilities);
                facilityListHTML = "";
                currentFacilityListItem = "";
                mappedFacility = ""
                    // currentFacilityRowShown = false;
                facilities.forEach(function(facility, index) {
                    facilityName = facility.name;
                    telephone = facility.telephone;
                    area = facility.area;
                    availability = facility.availability;
                    covidFacilityType = facility.covidFacilityType;
                    covidStatus = $("#test_status").val() == "POSITIVE" ? "CONFIRMED" : "SUSPECTED";
                    facilityId = facility.facilityId;
                    isMapped = facility.mapped;
                    row = '<div class="columns-7 w-row ' + (isMapped ? "recomended" : "") + '">\
                                <div class="w-col w-col-3">\
                                    <div class="pd-list">' + facilityName + '</div>\
                                </div>\
                                <div class="w-col w-col-2">\
                                    <div class="pd-list">' + area + '</div>\
                                </div>\
                                <div class="w-col w-col-2">\
                                    <div class="pd-list">' + covidFacilityType + '</div>\
                                </div>\
                                <div class="w-col w-col-2">\
                                    <div class="pd-list">' + covidStatus + '</div>\
                                </div>\
                                <div class="w-col w-col-2">\
                                    <div class="pd-list">' + availability + '</div>\
                                </div>\
                                <div class="w-col w-col-1"><a href="#" id="facility_' + facilityId + '" onClick="$.selectFacility(' + facilityId + ')" class="button-2 w-button">select</a></div>\
                            </div>';
                    if (isMapped)
                        mappedFacility += row;
                    else
                        facilityListHTML += row
                }); //forEach facilities
                facilityListHTML = mappedFacility + facilityListHTML;
                if (facilities.length == 0) {
                    facilityListHTML = "<center>No Facilities Found</center>";
                }
                $("#facility_list").html(facilityListHTML);
                $.selectFacility(0);
            } //showFacility

            function fetchWards() { //exec_3
                wardsURL = apiURL + "facilities/" + currentFacility.facilityId + "/wards";
                data = {
                    "authToken": window.localStorage.getItem("authToken"),
                    "severity": $("#severity").val(),
                    "testStatus": $("#test_status").val(),
                }
                log("Fetching wards data:", data);
                $.ajax({
                    type: "POST",
                    url: wardsURL,
                    data: JSON.stringify(data),
                    headers: headers,
                    success: function(res) {
                        log("Wards response", res);
                        showWards(res.data.list);
                    }, //success function ends
                    error: function(jqXHR, textStatus, error) {
                        alert("error: " + error);
                    },
                }); //fetch wards ajax
            }

            $.selectWard = function(wardId) {
                $("#ward_" + selectedWardId).html("Select");
                $("#ward_" + selectedWardId).css("background-color", "#4c72bf");
                $("#ward_" + wardId).html("Selected");
                $("#ward_" + wardId).css("background-color", "green");
                selectedWardId = wardId;
                selectedFacilityId = currentFacility.facilityId;
                log("selecting ward: ", {
                    "ward": selectedWardId,
                    "facility": selectedFacilityId
                });
            }

            function showWards(wards) { // exec_4
                log("Showing Wards:", wards);
                wardListHTML = "";
                if (patientStatusData != null)
                    $("#severity_1").html(severityMap[patientStatusData.severity] + " Severity");
                wards.forEach(function(ward, index) {
                    test_status = $("#test_status").val() == "POSITIVE" ? "CONFIRMED" : "SUSPECTED";
                    log("Test_status: ", test_status);
                    if (ward.severity.toLowerCase() == $("#severity").val().toLowerCase() && ward.covidStatus.toLowerCase() == test_status.toLowerCase()) {
                        recommended = "recomended";
                    } else {
                        recommended = "";
                    }
                    row = '<div class="columns-7 ' + recommended + ' w-row">\
                                <div class="w-col w-col-3">\
                                    <div class="pd-list">' + ward.name + '</div>\
                                </div>\
                                <div class="w-col w-col-3">\
                                    <div class="pd-list">' + severityMap[ward.severity] + '</div>\
                                </div>\
                                <div class="w-col w-col-3">\
                                    <div class="pd-list">' + ward.covidStatus + '</div>\
                                </div>\
                                <div class="w-col w-col-2">\
                                    <div class="pd-list">' + ward.availableBeds + '</div>\
                                </div>\
                                <div class="w-col w-col-1"><a href="#" id="ward_' + ward.id + '" onClick="$.selectWard(' + ward.id + ')" class="button-2 w-button">select</a></div>\
                            </div>';
                    // if (patientStatusData != null && ward.id == patientStatusData.wardId) {
                    //     wardListHTML = row + wardListHTML;
                    // } else {
                    wardListHTML += row;
                    // }
                }); //forEach
                if (wards.length == 0) {
                    wardListHTML = "<center>No Wards Found</center>";
                }
                $("#ward_list").html(wardListHTML);
                try {
                    if (patientStatusData != null)
                        $.selectWard(patientStatusData.wardId);
                } catch (e) {
                    console.error(e);
                }
            }
            $("#allocate_your_facility").click(function(e) {
                fetchWards();
                selectedFacilityId = currentFacility.facilityId;
                wardOrFacility = true;
                // e.preventDefault();
            });

            $("#allocate_other_facility").click(function(e) {
                fetchFacility();
                wardOrFacility = false;
                // e.preventDefault();
            });
            $("#severity").change(function(e) {
                // selectedFacilityId = currentFacility.facilityId;
                if (!wardOrFacility)
                    fetchFacility();
                else
                    fetchWards();
                $("#severity_1").html(severityMap[$("#severity").val()] + " Severity");
            }); //severity change
            $("#test_status").change(function(e) {
                // selectedFacilityId = currentFacility.facilityId;
                if (!wardOrFacility)
                    fetchFacility();
                else
                    fetchWards();
            }); //test_status change
            $("#remove_patient").click(function(e) {
                $("#discharge_popup").show();
                $("#patient_form").hide();
                e.preventDefault();
            });
            $("#discharge_form_cancel").click(function(e) {
                $("#discharge_popup").hide();
                $("#patient_form").show();
            });
            $("#discharge_reason").change(function(e) {
                if ($("#discharge_reason").val() == "DISCHARGED") {
                    $("#discharge_quarantine_type_block").show();
                } else {
                    $("#discharge_quarantine_type_block").hide();
                    $("#discharge_quarantine_type").val("HOME_QUARANTINE");
                }
            });
            $("#discharge_form").submit(function(e) {
                data = dataAuthToken;
                data["patientHospitalId"] = patientProfileData.patientHospitalId == null ? "" : patientProfileData.patientHospitalId;
                data["severity"] = patientStatusData.severity;
                data["testStatus"] = patientStatusData.testStatus;
                data["facilityId"] = patientStatusData.facilityId;
                data["wardId"] = patientStatusData.wardId;
                data["reason"] = $("#discharge_reason").val();
                data["quarantineType"] = $("#discharge_quarantine_type").val();

                dischargePatientURL = apiURL + "patients/" + getUrlParam("patient_id") + "/discharge/post";
                log("Patient Discharge data:", data);
                $.ajax({
                    type: "POST",
                    url: dischargePatientURL,
                    data: JSON.stringify(data),
                    headers: headers,
                    success: function(res) {
                        log("Patient Discharge response:", res);
                        if (res.data.success) {
                            alert("Removed Patient successfully");
                            window.location.replace("list-of-patients.html");
                        } else {
                            alert("Could not remove patient.");
                        }
                    }, //success function ends
                    error: function(jqXHR, textStatus, error) {
                        alert("Patient Discharge error: " + error);
                    },
                }); //discharge patient ajax
                e.preventDefault();
            });
        }); //document ready
    </script>
</body>

</html>